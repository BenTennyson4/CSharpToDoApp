<!DOCTYPE html>
<html>
    <head>
        <title>C# to do app</title>
        <meta charset="utf-8">
        <meta name="author" content="Ben Tennyson">
        <meta name="description" content="">
        <link rel="stylesheet" href="indexStyles.css">
        <link rel="html" href="homePage.html">
        <link rel="html" href="createAccount.html">
    </head>
    <body>
        <div class="login">
            <h1>Login</h1>
            <input type="text" class="username" placeholder="Username">
            <input type="password" class="password" placeholder="Password">
            <button onclick=login() class="loginButton">Login</button>
            <button onclick=createUser() class="createUserButton">Create Account</button>
        </div>
        <script>

            async function login() {
                const usernameField = document.querySelector("input.username");
                const passwordField = document.querySelector("input.password");

                // Get the values from the username and password elements and remove leading and trailing whitespace with trim()
                const username = usernameField.value.trim();
                const password = passwordField.value.trim();

                // Ensure that username and password are not empty
                if (!username || !password) {
                    alert("Make sure to enter a user name and password");
                }

                // Dto for login information
                const loginInfo = {
                    username: username,
                    password: password
                };

                /* 
                Check if the database contains the username and password by sending the username and password entered by 
                the user to API endpoint for the login.
                */
               console.log("Sending login info to backend:", loginInfo);
                try {
                    const response = await fetch("/login", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify(loginInfo)
                    });

                    if (!response.ok) {
                        throw new Error("Server returned error status.");
                    }

                    const result = await response.json();
                    console.log("Server response:", result);

                    // Check if the result is true
                    if (result === true) {
                        window.location.href = "homePage.html";
                    } else {
                        alert("Invalid username or password.");
                    }
                
                } catch(err) {
                    console.error("Login failed:", err);
                    alert("An error occurred while logging in.");
                }         
            }


            async function createUser() {
                window.location.href = "createAccount.html";


            }

        </script>

    </body>
</html>